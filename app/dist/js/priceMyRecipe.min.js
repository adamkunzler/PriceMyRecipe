!function(e){"use strict";angular.module("app.recipe",["ngRoute","ngSanitize","ngCookies","ui.bootstrap","ghiscoding.validation","pascalprecht.translate"]).constant("pmrConfig",{SECRET_WORD:"samelliot"}).config(["$routeProvider","$translateProvider","$httpProvider",function(e,n,t){t.interceptors.push(["$location","$injector","$log",function(e,n,t){return{request:function(t){var r=n.get("UserService");return r.isAuthenticated()||e.path("/login"),t}}}]),n.useStaticFilesLoader({prefix:"../vendors/",suffix:".json"}),n.preferredLanguage("en"),n.useSanitizeValueStrategy("sanitize"),e.when("/login",{templateUrl:"User/UserLoginView.html",controller:"UserLoginController"}).when("/home",{templateUrl:"root/home.html",controller:"GeneralController"}).when("/recipe",{templateUrl:"Recipe/RecipeView.html",controller:"RecipeController"}).when("/recipe/new",{templateUrl:"Recipe/RecipeDetailsView.html",controller:"NewRecipeController"}).when("/recipe/edit",{templateUrl:"Recipe/RecipeDetailsView.html",controller:"EditRecipeController"}).when("/ingredient/add",{templateUrl:"Ingredient/AddIngredientView.html",controller:"AddIngredientController"}).when("/ingredient/store",{templateUrl:"Ingredient/StoreIngredientDetailsView.html",controller:"StoreIngredientDetailsController"}).when("/ingredient/recipe",{templateUrl:"Ingredient/RecipeIngredientDetailsView.html",controller:"RecipeIngredientDetailsController"}).when("/store/new",{templateUrl:"Store/StoreDetailsView.html",controller:"StoreDetailsController"}).when("/admin/ingredients",{templateUrl:"Admin/Ingredients/IngredientsView.html",controller:"IngredientsController"}).when("/admin/stores",{templateUrl:"Admin/Stores/StoresView.html",controller:"StoresController"}).otherwise({redirectTo:"/login"})}]).run(["$rootScope",function(e){console.log("running..."),e.$on("$locationChangeStart",function(n,t,r){e.previousRoute=r.substr(r.indexOf(".html#")+6)})}]),angular.module("app.recipe").controller("GeneralController",["$scope","UserService",function(e,n){e.isAdmin=function(){return n.isAdmin()},e.isAuth=function(){return n.isAuthenticated()},e.logout=function(){n.logout()}}])}(),function(e){"use strict";angular.module("app.recipe").controller("AddIngredientController",["$rootScope","$scope","$location","validationService","IngredientService","AddIngredientModel",function(n,t,r,i,o,c){t.ingredients=[],t.ingredient=e,t["continue"]=function(){if((new i).checkFormValidity(t.frmAddIngredient))if(t.isCustom){if(!a(t.ingredient.name))return void alert("Ingredient name is not unique: "+t.ingredient.name);d(t.ingredient).then(function(e){t.ingredient.id=e,u()})}else u()},t.nevermind=function(){c.reset(),r.path("/recipe")},t.validateExistingIngredient=function(){for(var e=!1,n=0;n<t.ingredients.length;n++)if(t.ingredients[n].id===t.ingredient.id){e=!0;break}return{isValid:e,message:"Must choose an ingredient from the list."}},t.resetForm=function(){t.ingredient=e,t.ingredient=e,(new i).resetForm(t.frmAddIngredient),console.log("reset")};var u=function(){t.ingredient.id&&(c.ingredient=angular.copy(t.ingredient),r.path("/ingredient/store"))},a=function(e){for(var n=!0,r=0;r<t.ingredients.length;r++)if(t.ingredients[r].name===e){n=!1;break}return n},d=function(e){return o.insertIngredient(e).then(function(e){return e},function(){alert("ERROR: Ingredient not created: "+e.name)})},s=function(){return o.getAllIngredients().then(function(e){t.ingredients=e||[]})},l=function(){c.ingredient!==e&&"/ingredient/store"===n.previousRoute&&(t.ingredient=angular.copy(c.ingredient)),s()};l()}])}(),function(e){"use strict";angular.module("app.recipe").factory("AddIngredientModel",function(){var n={};return n.ingredient=e,n.storeIngredient=e,n.recipeIngredient=e,n.reset=function(){n.ingredient=e,n.storeIngredient=e,n.recipeIngredient=e},n})}(),function(e){"use strict";angular.module("app.recipe").controller("RecipeIngredientDetailsController",["$scope","$q","$location","validationService","AddIngredientModel","MeasurementService","RecipeIngredientService",function(e,n,t,r,i,o,c){e.addToRecipe=function(){(new r).checkFormValidity(e.frmRecipeIng)&&(e.recipeIngredient.partialAmount||e.recipeIngredient.wholeAmount)&&(e.recipeIngredient.wholeAmount||(e.recipeIngredient.wholeAmount=0),a(e.recipeIngredient).then(function(n){e.recipeIngredient.id=n,u()}))},e.goBack=function(){i.reset(),t.path("/recipe")};var u=function(){e.recipeIngredient.id&&(i.recipeIngredient=angular.copy(e.recipeIngredient),t.path("/recipe"))},a=function(e){return c.insertRecipeIngredient(e).then(function(e){return e?e:void n.reject()},function(){alert("ERROR: RecipeIngredient not created: "+e.ingredient.name)})},d=function(){return i.storeIngredient?(e.model=i,e.recipeIngredient={},e.recipeIngredient.ingredient=angular.copy(i.ingredient),e.recipeIngredient.storeIngredient=angular.copy(i.storeIngredient),e.recipeIngredient.recipe={},e.recipeIngredient.recipe.id=localStorage.getItem("pmr_recipeId"),e.partialAmounts=o.getPartialAmounts(),void(e.measurementTypes=o.getMeasurementTypes("weight"===e.model.ingredient.measureType))):void alert("Something's wrong: store ingredient didn't carry over from last page.")};d()}])}(),function(e){"use strict";angular.module("app.recipe").controller("StoreIngredientDetailsController",["$scope","$location","$uibModal","validationService","MeasurementService","StoreService","StoreIngredientService","AddIngredientModel",function(n,t,r,i,o,c,u,a){n["continue"]=function(){(new i).checkFormValidity(n.frmStoreIng)&&(n.storeIngredient.id?p(n.storeIngredient).then(function(){l()}):g(n.storeIngredient).then(function(e){n.storeIngredient.id=e,l()}))},n.goBack=function(){a.reset(),t.path("/recipe")},n.storeChanged=function(){var e=n.storeIngredient,t=e.ingredient.id,r=e.store.id;f(r,t).then(function(n){n?(e.id=parseInt(n.id),e.quantity=parseInt(n.quantity),e.quantityType=s(n.quantityType.value),e.cost=parseFloat(n.cost),e.isOrganic="true"===n.isOrganic):d()})},n.addNewStore=function(){var e=r.open({animation:!0,templateUrl:"Admin/Stores/NewStoreView.html",controller:"NewStoreController",size:"sm"});e.result.then(function(e){e&&m(e).then(function(e){e&&(n.stores.push(e),n.storeIngredient.store=e,d())})})};var d=function(){var t=n.storeIngredient;t.quantity=e,t.quantityType=e,t.cost=e,t.isOrganic=!1},s=function(e){var t=n.quantityTypes.map(function(e){return e.value}).indexOf(e);return t>-1?n.quantityTypes[t]:null},l=function(){n.storeIngredient.id&&(a.storeIngredient=angular.copy(n.storeIngredient),t.path("/ingredient/recipe"))},g=function(e){return u.insertStoreIngredient(e).then(function(e){return e},function(){alert("ERROR: StoreIngredient not created: "+e.ingredient.name)})},p=function(e){return u.updateStoreIngredient(e).then(function(){},function(){alert("ERROR: StoreIngredient not updated: "+e.ingredient.name)})},f=function(e,n){return u.getStoreIngredient(e,n).then(function(e){return e})},m=function(e){return c.getStoreById(e).then(function(e){return e?e:void 0},function(){alert("ERROR: Store not found for id: "+e)})},I=function(){return c.getAllStores().then(function(e){n.stores=e||[]})},R=function(){return a.ingredient?(n.storeIngredient={isOrganic:!1},n.storeIngredient.ingredient=angular.copy(a.ingredient),n.quantityTypes=o.getStoreQuantityTypes("weight"===n.storeIngredient.ingredient.measureType),void I()):void alert("Something's wrong: ingredient didn't carry over from last page.")};R()}])}(),function(e){"use strict";angular.module("app.recipe").controller("EditRecipeController",["$scope","$q","$location","validationService","RecipeService",function(e,n,t,r,i){e.recipe={},e["continue"]=function(){(new r).checkFormValidity(e.frmRecipe)&&o(e.recipe).then(function(){t.path("/recipe")})},e.nevermind=function(){t.path("/recipe")};var o=function(e){return i.updateRecipe(e).then(function(){},function(){return alert("ERROR: Recipe not updated: "+e.name),n.reject()})},c=function(n){return i.getRecipeById(n).then(function(n){n&&(e.recipe=n)},function(){alert("ERROR: Recipe not found for id: "+n)})},u=function(){var e=localStorage.getItem("pmr_recipeId");e?c(e):(alert("Somehow the loaded recipe got unloaded. Please reload it at your leisure."),t.path("/recipe"))};u()}])}(),function(e){"use strict";angular.module("app.recipe").controller("NewRecipeController",["$rootScope","$scope","$location","validationService","RecipeService",function(e,n,t,r,i){n.recipe={},n.recipe.notes="",n["continue"]=function(){(new r).checkFormValidity(n.frmRecipe)&&o(n.recipe).then(function(e){localStorage.setItem("pmr_recipeId",e),t.path("/recipe")})},n.nevermind=function(){"/recipe"===e.previousRoute?t.path("/recipe"):t.path("/home")};var o=function(e){return i.insertRecipe(e).then(function(e){return e},function(){alert("ERROR: Recipe not created: "+e.name)})},c=function(){};c()}])}(),function(e){"use strict";angular.module("app.recipe").controller("RecipeController",["$scope","$sce","$q","$location","RecipeModel","RecipeService","RecipeIngredientService","MeasurementService",function(n,t,r,i,o,c,u,a){n.editRecipe=function(){var e=s();e&&i.path("/recipe/edit")},n.updateNotes=function(){l(n.model.recipe)},n.loadRecipe=function(e){localStorage.setItem("pmr_recipeId",e),p(e)},n.newRecipe=function(){i.path("/recipe/new")},n.calculateIngredientCost=function(e){var n=a.calculateIngredientCost(e);return n},n.calculateTotalCost=function(){var e=0;if(angular.isDefined(n.model.recipe)&&angular.isDefined(n.model.recipe.ingredients))for(var t=0;t<n.model.recipe.ingredients.length;t++)e+=n.calculateIngredientCost(n.model.recipe.ingredients[t]);return e},n.calculatePerServingCost=function(){if(angular.isDefined(n.model.recipe)&&angular.isDefined(n.model.recipe.ingredients)){var e=n.calculateTotalCost();return e/n.model.recipe.numServings}return 0},n.deleteIngredient=function(e){var t=n.model.recipe.ingredients.map(function(e){return e.id}).indexOf(e);confirm("Are you sure you want to delete '"+n.model.recipe.ingredients[t].ingredient.name+"'?")&&u.deleteIngredient(e).then(function(){n.model.recipe.ingredients.splice(t,1)},function(e){alert("ERROR: Unable to delete ingredient from recipe: "+e)})},n.formatIngredientAmount=function(e){var t=n.measurementTypes.map(function(e){return e.value}).indexOf(e.measurementType),r=""+("0"===e.wholeAmount?"":e.wholeAmount);return r+=""!==e.partialAmount?d(e.partialAmount):"",r+=" "+n.measurementTypes[t].abbr},n.saveToPDF=function(){window.print()};var d=function(e){return"&nbsp;<sup>"+e[0]+"</sup>&frasl;<sub>"+e[2]+"</sub>"},s=function(){var n=localStorage.getItem("pmr_recipeId");return n?parseInt(n):e},l=function(e){return c.updateRecipe(e).then(function(){},function(){return alert("ERROR: Recipe not updated: "+e.name),r.reject()})},g=function(e){return n.model.recipes.map(function(e){return e.id}).indexOf(e)},p=function(e){var t=g(e);t>=0?(n.model.recipe=n.model.recipes[t],n.model.recipe.ingredients=[],f(e),n.recipeLoaded=!0):n.recipeLoaded=!1},f=function(e){n.model.recipe&&0===n.model.recipe.ingredients.length&&u.getAllRecipeIngredients(e).then(function(e){angular.isArray(e)?n.model.recipe.ingredients=e||[]:(n.model.recipe.ingredients=[],n.model.recipe.ingredients.push(e))},function(){alert("ERROR: Ingredients not loaded for recipe id: "+e)})},m=function(){return c.getAllRecipes().then(function(e){angular.isArray(e)?n.model.recipes=e||[]:(n.model.recipes=[],n.model.recipes.push(e))})},I=function(){n.model=o,n.recipeLoaded=!1,n.measurementTypes=a.getMeasurementTypes(),m().then(function(){var e=s();e&&p(e)})};I()}])}(),function(e){"use strict";angular.module("app.recipe").factory("RecipeModel",function(){var n={};return n.recipe=e,n.recipes=[],n})}(),function(e){"use strict";angular.module("app.recipe").factory("DALService",["$http","$q","$log",function(e,n,t){function r(e){var n="";if(e)for(var t=0;t<e.length;t++)n+="&"+e[t];return encodeURI(n)}function i(e){if(e.data&&e.data[0]&&e.data[0].message){var n=e.data[0].message;return t.log(n),n}}var o={};return o.executeQuery=function(o,c,u){var a=r(u);return e.get(o+"?query="+c+a).then(function(e){var t=i(e);return t?n.reject("ERROR: "+t):1===e.data.length?e.data[0]:e.data},function(e){var r="SERVER ERROR: "+c+" : "+a+" : msg="+JSON.stringify(e);return t.log(r),n.reject(r)})},o.executeNonQuery=function(o,c,u){var a=r(u);return e.get(o+"?query="+c+a).then(function(e){var t=i(e);return t?n.reject("ERROR: "+t):e.data[0]},function(e){var r="SERVER ERROR: "+c+" : "+a+" : msg="+JSON.stringify(e);return t.log(r),n.reject(r)})},o}])}(),function(e){"use strict";angular.module("app.recipe").factory("IngredientService",["$http","$q","$log","DALService",function(n,t,r,i){var o={},c="http://test.adamkunzler.com/PHP/ingredients.php";return o.getIngredientById=function(e){return i.executeQuery(c,"getIngredientById",["ingId="+e]).then(function(e){return e?e:t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},o.getAllIngredients=function(){return i.executeQuery(c,"getAllIngredients").then(function(e){if(e){if(angular.isArray(e))return e;var n=[];return n.push(e),n}},function(e){r.log("SERVICE ERROR: "+e)})},o.updateIngredient=function(e){var n=["id="+e.id,"name="+e.name,"measureType="+e.measureType,"gramsPerCup="+e.gramsPerCup];return i.executeNonQuery(c,"updateIngredient",n).then(function(e){return e&&-1!==e.rowsAffected?void 0:t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},o.insertIngredient=function(n){var o=["name="+n.name,"measureType="+n.measureType,"gramsPerCup="+n.gramsPerCup];return i.executeNonQuery(c,"insertIngredient",o).then(function(n){return n!==e&&0!==n.generatedId&&-1!==n.rowsAffected?n.generatedId:t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},o.deleteIngredient=function(n){return i.executeNonQuery(c,"deleteIngredient",["id="+n]).then(function(n){return n!==e&&-1!==n.rowsAffected?void 0:t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},o}])}(),function(undefined){"use strict";angular.module("app.recipe").factory("MeasurementService",function(){var service={},GRAMS_PER_POUND=453.592,_cupConversion={cups:1,tbsp:16,tsp:48,oz:10},_ounceConversion={cups:10,tbsp:.625,tsp:.208,oz:1};return service.calculateIngredientCost=function(recipeIngredient){var cost=0;if("pieces"===recipeIngredient.storeIngredient.quantityType){var costPerPiece=parseFloat(recipeIngredient.storeIngredient.cost)/parseInt(recipeIngredient.storeIngredient.quantity);cost=costPerPiece*(parseInt(recipeIngredient.wholeAmount)+(""!==recipeIngredient.partialAmount?eval(recipeIngredient.partialAmount):0))}else if("ounces"===recipeIngredient.storeIngredient.quantityType){var costPerOunce=parseFloat(recipeIngredient.storeIngredient.cost)/parseInt(recipeIngredient.storeIngredient.quantity),totalMeasureType=parseInt(recipeIngredient.wholeAmount)+(""!==recipeIngredient.partialAmount?eval(recipeIngredient.partialAmount):0),totalOunces=totalMeasureType*_ounceConversion[recipeIngredient.measurementType];cost=totalOunces*costPerOunce}else if("pounds"===recipeIngredient.storeIngredient.quantityType){var costPerPound=parseFloat(recipeIngredient.storeIngredient.cost)/parseInt(recipeIngredient.storeIngredient.quantity),costPerGram=costPerPound/GRAMS_PER_POUND,totalMeasureType=parseInt(recipeIngredient.wholeAmount)+(""!==recipeIngredient.partialAmount?eval(recipeIngredient.partialAmount):0),totalCups=totalMeasureType/_cupConversion[recipeIngredient.measurementType],totalGrams=parseInt(recipeIngredient.ingredient.gramsPerCup)*totalCups;cost=totalGrams*costPerGram}return cost},service.getStoreQuantityTypes=function(e){return e?[{name:"Pounds",value:"pounds"},{name:"Ounces",value:"ounces"}]:[{name:"Pieces",value:"pieces"}]},service.getMeasurementTypes=function(e){var n=[{name:"Cups",abbr:"Cups",value:"cups"},{name:"Tablespoons",abbr:"Tbsp.",value:"tbsp"},{name:"Teaspoons",abbr:"Tsp.",value:"tsp"},{name:"Ounces",abbr:"Ounces",value:"oz"}],t=[{name:"Pieces",abbr:"Pieces",value:"pieces"}];return e===undefined?n.concat(t):e?n:t},service.getPartialAmounts=function(){return["3/4","2/3","1/2","1/3","1/4","1/8"]},service})}(),function(e){"use strict";angular.module("app.recipe").factory("RecipeIngredientService",["$http","$log","$q","DALService","UserService",function(n,t,r,i,o){var c={},u="http://test.adamkunzler.com/PHP/recipeingredients.php";return c.deleteIngredient=function(n){return i.executeNonQuery(u,"deleteIngredient",["id="+n]).then(function(n){return n!==e&&-1!==n.rowsAffected?void 0:r.reject()},function(e){t.log("SERVICE ERROR: "+e)})},c.getAllRecipeIngredients=function(e){var n=["recipeId="+e];return i.executeQuery(u,"getAllRecipeIngredients",n).then(function(e){return e?e:void 0},function(e){t.log("SERVICE ERROR: "+e)})},c.insertRecipeIngredient=function(n){var o=["ingredientId="+n.ingredient.id,"recipeId="+n.recipe.id,"storeIngredientId="+n.storeIngredient.id,"wholeAmount="+n.wholeAmount,"partialAmount="+(angular.isDefined(n.partialAmount)?n.partialAmount:""),"measurementType="+n.measurementType.value];return i.executeNonQuery(u,"insertRecipeIngredient",o).then(function(n){return n!==e&&0!==n.generatedId&&-1!==n.rowsAffected?n.generatedId:r.reject()},function(e){t.log("SERVICE ERROR: "+e)})},c}])}(),function(e){"use strict";angular.module("app.recipe").factory("RecipeService",["$http","$q","$log","UserService","DALService",function(n,t,r,i,o){var c={},u="http://test.adamkunzler.com/PHP/recipes.php",a=i.currentUser.id,d="APOSTROPHE";return c.getRecipeById=function(e){return o.executeQuery(u,"getRecipeById",["id="+e]).then(function(e){if(e){var n=new RegExp(d,"g");return e.notes=e.notes.replace(n,"'"),e}return t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},c.getAllRecipes=function(){return o.executeQuery(u,"getAllRecipes",["userId="+a]).then(function(e){if(e){var n=[];return angular.isArray(e)?n=e:n.push(e),angular.forEach(n,function(e){var n=new RegExp(d,"g");e.notes=e.notes.replace(n,"'")}),n}},function(e){r.log("SERVICE ERROR: "+e)})},c.updateRecipe=function(n){var i=n.notes.replace(/\'/g,d),c=["id="+n.id,"name="+n.name,"numServings="+n.numServings,"notes="+i,"userId="+a];return o.executeNonQuery(u,"updateRecipe",c).then(function(n){return n!==e&&n.rowsAffected!==e&&-1!==n.rowsAffected?void 0:t.reject()},function(e){return r.log("SERVICE ERROR: "+e),t.reject()})},c.insertRecipe=function(e){var n=["name="+e.name,"numServings="+e.numServings,"notes="+e.notes,"userId="+a];return o.executeNonQuery(u,"insertRecipe",n).then(function(e){return e&&0!==e.generatedId&&-1!==e.rowsAffected?e.generatedId:t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},c}])}(),function(e){"use strict";angular.module("app.recipe").factory("StoreIngredientService",["$http","$q","$log","UserService","DALService",function(n,t,r,i,o){var c={},u="http://test.adamkunzler.com/PHP/storeingredients.php";return c.getStoreIngredient=function(n,i){var c=["storeId="+n,"ingredientId="+i];return o.executeQuery(u,"getStoreIngredient",c).then(function(n){if(n){var r=angular.isArray(n);return r?e:n}return t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},c.insertStoreIngredient=function(n){var i=["ingredientId="+n.ingredient.id,"storeId="+n.store.id,"quantity="+n.quantity,"quantityType="+n.quantityType.value,"cost="+n.cost,"isOrganic="+n.isOrganic];return o.executeNonQuery(u,"insertStoreIngredient",i).then(function(n){return n!==e&&0!==n.generatedId&&-1!==n.rowsAffected?n.generatedId:t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},c.updateStoreIngredient=function(e){var n=["id="+e.id,"ingredientId="+e.ingredient.id,"storeId="+e.store.id,"quantity="+e.quantity,"quantityType="+e.quantityType.value,"cost="+e.cost,"isOrganic="+e.isOrganic];return o.executeNonQuery(u,"updateStoreIngredient",n).then(function(e){return e&&-1!==e.rowsAffected?void 0:t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},c}])}(),function(e){"use strict";angular.module("app.recipe").factory("StoreService",["$http","$q","$log","UserService","DALService",function(n,t,r,i,o){var c={},u="http://test.adamkunzler.com/PHP/stores.php",a=i.currentUser.id;return c.getStoreById=function(e){return o.executeQuery(u,"getStoreById",["id="+e]).then(function(e){return e?e:t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},c.getAllStores=function(){return o.executeQuery(u,"getAllStores",["userId="+a]).then(function(e){return e?e:void 0},function(e){r.log("SERVICE ERROR: "+e)})},c.insertStore=function(n){var i=["userId="+a,"name="+n.name,"notes="+n.notes];return o.executeNonQuery(u,"insertStore",i).then(function(n){return n!==e&&0!==n.generatedId&&-1!==n.rowsAffected?n.generatedId:t.reject()},function(e){r.log("SERVICE ERROR: "+e)})},c.updateStore=function(n){var i=["id="+n.id,"userId="+n.userId,"name="+n.name,"notes="+n.notes];return o.executeNonQuery(u,"updateStore",i).then(function(n){return n!==e&&n.rowsAffected!==e&&-1!==n.rowsAffected?void 0:t.reject()},function(e){return r.log("SERVICE ERROR: "+e),t.reject()})},c}])}(),function(e){"use strict";angular.module("app.recipe").factory("UserService",["$q","$log","$cookies","$location","pmrConfig","DALService",function(e,n,t,r,i,o){var c={},u="http://test.adamkunzler.com/PHP/users.php";return c.login=function(r,a){var d=["username="+r,"password="+a];return o.executeQuery(u,"login",d).then(function(n){return angular.isDefined(n)&&n.id?(c.currentUser={},c.currentUser.id=parseInt(n.id),c.currentUser.username=n.username,c.currentUser.isAdmin="true"===n.isAdmin,c.authValue=btoa(n.id+n.username+i.SECRET_WORD),t.put("pmr_"+n.username,c.authValue),!0):e.reject("Invalid username or password.")},function(e){n.log("SERVICE ERROR: "+e)})},c.logout=function(){n.log("logging out..."),t.remove("pmr_"+c.currentUser.username),r.path("/login")},c.isAdmin=function(){return angular.isDefined(c.currentUser)&&c.currentUser.isAdmin},c.isAuthenticated=function(){return angular.isDefined(c.currentUser)?t.get("pmr_"+c.currentUser.username)===c.authValue:!1},c}])}(),function(e){"use strict";angular.module("app.recipe").controller("StoreDetailsController",["$scope",function(e){var n=function(){};n()}])}(),function(e){"use strict";angular.module("app.recipe").controller("UserLoginController",["$scope","$log","$location","validationService","UserService",function(e,n,t,r,i){e.login=function(o,c){if((new r).checkFormValidity(e.frmUserLogin)){var u=btoa(c);i.login(o,u).then(function(e){e&&(n.log("logged in..."),t.path("/recipe"))},function(n){e.login.error=n})}};var o=function(){};o()}])}(),function(e){"use strict";angular.module("app.recipe").controller("EditIngredientController",["$scope","$uibModalInstance","$q","validationService","IngredientService","ingredient",function(e,n,t,r,i,o){e.ingredient=o,e.ok=function(){return(new r).checkFormValidity(e.frmEditIngredient)?u(e.ingredient.name,e.ingredient.id)?void c(e.ingredient).then(function(){d().then(function(e){e&&n.close(e)})}):void alert("Ingredient name is not unique: "+e.ingredient.name):void 0},e.cancel=function(){n.dismiss("cancel")};var c=function(e){return i.updateIngredient(e).then(function(){},function(){alert("ERROR: Ingredient not updated: "+e.name)})},u=function(n,t){for(var r=!0,i=0;i<e.ingredients.length;i++)if(e.ingredients[i].id!==t&&e.ingredients[i].name===n){r=!1;break}return r},a=function(){return i.getAllIngredients().then(function(n){e.ingredients=n||[]})},d=function(){return i.getIngredientById(o.id).then(function(e){return e?e:(alert("ERROR: Ingredient not found for id: "+o.id),t.reject())})},s=function(){a(),d().then(function(n){n&&(e.ingredient=n)})};s()}])}(),function(e){"use strict";angular.module("app.recipe").controller("IngredientsController",["$scope","$http","$uibModal","IngredientService",function(n,t,r,i){n.sortType="name",n.sortReverse=!1,n.searchIngredient="",n.ingredients=e,n.addIngredient=function(){var e=r.open({animation:!0,templateUrl:"Admin/Ingredients/NewIngredientView.html",controller:"NewIngredientController",size:"sm"});e.result.then(function(e){e&&o(e).then(function(e){e&&n.ingredients.push(e)})})},n.editIngredient=function(e){var t=r.open({animation:!0,templateUrl:"Admin/Ingredients/EditIngredientView.html",controller:"EditIngredientController",size:"sm",resolve:{ingredient:{id:e}}});t.result.then(function(e){if(e)for(var t=0;t<n.ingredients.length;t++)if(n.ingredients[t].id===e.id){n.ingredients[t]=angular.copy(e);break}})},n.deleteIngredient=function(e){var t=n.ingredients.map(function(e){return e.id}).indexOf(e);confirm("Are you sure you want to delete '"+n.ingredients[t].name+"'?")&&i.deleteIngredient(e).then(function(){n.ingredients.splice(t,1)},function(e){alert("ERROR: Unable to delete ingredient: "+e)})};var o=function(e){return i.getIngredientById(e).then(function(e){return e?e:void 0},function(){alert("ERROR: Ingredient not found for id: "+e)})},c=function(){return i.getAllIngredients().then(function(e){n.ingredients=e||[]})},u=function(){c()};u()}])}(),function(e){"use strict";angular.module("app.recipe").controller("NewIngredientController",["$scope","$uibModalInstance","validationService","IngredientService",function(n,t,r,i){n.ingredient=e,n.ok=function(){return(new r).checkFormValidity(n.frmAddIngredient)?o(n.ingredient.name)?void u(n.ingredient).then(function(e){t.close(e)}):void alert("Ingredient name is not unique: "+n.ingredient.name):void 0},n.cancel=function(){t.dismiss("cancel")};var o=function(e){for(var t=!0,r=0;r<n.ingredients.length;r++)if(n.ingredients[r].name===e){t=!1;break}return t},c=function(){return i.getAllIngredients().then(function(e){n.ingredients=e||[]})},u=function(e){return i.insertIngredient(e).then(function(e){return e},function(){alert("ERROR: Ingredient not created: "+e.name)})},a=function(){c()};a()}])}(),function(e){"use strict";angular.module("app.recipe").controller("EditStoreController",["$scope","$uibModalInstance","$q","validationService","StoreService","store",function(e,n,t,r,i,o){e.store=o,e.ok=function(){(new r).checkFormValidity(e.frmEditStore)&&c(e.store).then(function(){u().then(function(e){e&&n.close(e)})})},e.cancel=function(){n.dismiss("cancel")};var c=function(e){return i.updateStore(e).then(function(){},function(){alert("ERROR: Ingredient not updated: "+e.name)})},u=function(){return i.getStoreById(o.id).then(function(e){return e?e:(alert("ERROR: Store not found for id: "+o.id),t.reject())})},a=function(){u().then(function(n){n&&(e.store=n)})};a()}])}(),function(e){"use strict";angular.module("app.recipe").controller("NewStoreController",["$scope","$uibModalInstance","validationService","StoreService",function(n,t,r,i){n.store=e,n.ok=function(){(new r).checkFormValidity(n.frmAddStore)&&(n.store.notes="",o(n.store).then(function(e){t.close(e)}))},n.cancel=function(){t.dismiss("cancel")};var o=function(e){return i.insertStore(e).then(function(e){return e},function(){alert("ERROR: Store not created: "+e.name)})},c=function(){};c()}])}(),function(e){"use strict";angular.module("app.recipe").controller("StoresController",["$scope","$uibModal","StoreService",function(e,n,t){e.addStore=function(){var t=n.open({animation:!0,templateUrl:"Admin/Stores/NewStoreView.html",controller:"NewStoreController",size:"sm"});t.result.then(function(n){n&&r(n).then(function(n){n&&e.stores.push(n)})})},e.deleteStore=function(){alert("Not yet determined how to implement this feature.")},e.editStore=function(t){var r=n.open({animation:!0,templateUrl:"Admin/Stores/EditStoreView.html",controller:"EditStoreController",size:"sm",resolve:{store:{id:t}}});r.result.then(function(n){if(n)for(var t=0;t<e.stores.length;t++)if(e.stores[t].id===n.id){e.stores[t]=angular.copy(n);break}})};var r=function(e){return t.getStoreById(e).then(function(e){return e?e:void 0},function(){alert("ERROR: Store not found for id: "+e)})},i=function(){return t.getAllStores().then(function(n){e.stores=n||[]})},o=function(){i()};o()}])}();